<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ani Chat</title>
<style>
:root {
  --bg-dark: #050507;
  --glass-panel: rgba(20, 20, 25, 0.95);
  --accent: #6c5ce7;
  --text: #fff;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { margin: 0; background: var(--bg-dark); font-family: sans-serif; color: var(--text); overflow: hidden; position: fixed; inset: 0; }

#app { display: flex; flex-direction: column; height: 100%; width: 100%; background: var(--glass-panel); }

/* Header */
header { height: 60px; padding: 0 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.1); background: rgba(15,15,20,0.8); backdrop-filter: blur(10px); }
.back-btn { background: none; border: none; color: white; cursor: pointer; padding: 5px; }
.info { display: flex; align-items: center; gap: 10px; }
.avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(255,255,255,0.1); }
.status { width: 8px; height: 8px; border-radius: 50%; background: #23a559; box-shadow: 0 0 5px #23a559; }

/* Chat Area */
#chat-box { flex: 1; overflow-y: auto; padding: 20px 16px; display: flex; flex-direction: column; gap: 12px; }
.msg { max-width: 85%; padding: 10px 14px; border-radius: 18px; font-size: 15px; line-height: 1.4; word-wrap: break-word; }
.bot { align-self: flex-start; background: rgba(255,255,255,0.1); border-bottom-left-radius: 4px; color: #ddd; }
.user { align-self: flex-end; background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; border-bottom-right-radius: 4px; }

/* Input */
#input-area { padding: 12px 16px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 10px; background: #0b0b10; align-items: flex-end; padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
textarea { flex: 1; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 10px 15px; color: white; resize: none; font-size: 16px; height: 44px; max-height: 100px; font-family: inherit; }
textarea:focus { border-color: var(--accent); }
#send-btn { width: 44px; height: 44px; border-radius: 50%; border: none; background: var(--accent); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
#send-btn:disabled { opacity: 0.5; cursor: default; }

</style>
</head>
<body>
<div id="app">
  <header>
    <div class="info">
      <button class="back-btn" id="back-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg></button>
      <img src="https://i.postimg.cc/PrNFhBn3/Ani.jpg" class="avatar" onerror="this.src='https://ui-avatars.com/api/?name=Ani&background=6c5ce7&color=fff'">
      <div style="font-weight:600;">Ani</div>
    </div>
    <div class="status"></div>
  </header>
  
  <div id="chat-box"></div>
  
  <div id="input-area">
    <textarea id="msg-input" placeholder="Message..." rows="1"></textarea>
    <button id="send-btn" disabled><svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
  </div>
</div>

<script>
// Logic
const chatBox = document.getElementById("chat-box");
const input = document.getElementById("msg-input");
const btn = document.getElementById("send-btn");
const API = "https://hybrid-ani.onrender.com/chat"; // Change to localhost:3000/chat if using proxy

// Viewport Fix
if(window.visualViewport) {
  window.visualViewport.addEventListener('resize', () => {
    document.getElementById('app').style.height = window.visualViewport.height + 'px';
    window.scrollTo(0,0);
  });
}

function addMsg(text, type) {
  const d = document.createElement("div"); d.className = `msg ${type}`; d.innerText = text;
  chatBox.appendChild(d); chatBox.scrollTop = chatBox.scrollHeight;
}

async function send() {
  const txt = input.value.trim();
  if(!txt) return;
  addMsg(txt, "user");
  input.value = ""; input.style.height = "44px"; btn.disabled = true;

  try {
    const res = await fetch(API, {
        method: "POST", 
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({message: txt})
    });
    const data = await res.json();
    addMsg(data.reply || data.response || "...", "bot");
  } catch(e) {
    addMsg("Offline.", "bot");
  }
}

input.addEventListener('input', () => {
    input.style.height = "auto";
    input.style.height = input.scrollHeight + "px";
    btn.disabled = !input.value.trim();
});

btn.onclick = send;
input.onkeydown = e => { if(e.key==="Enter" && !e.shiftKey) { e.preventDefault(); send(); }};

document.getElementById('back-btn').onclick = () => window.parent.postMessage('close-chat', '*');
setTimeout(() => addMsg("Hello! I am Ani.", "bot"), 500);
</script>
</body>
</html>
